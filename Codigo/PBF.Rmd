---
title: "Bolsa Familia"
author: "Naranjo et al."
date: "2023-05-01"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE, echo=FALSE}
library(haven)
library(ggplot2)
library(gridExtra)
library(cowplot)
library(scales)
library(orca)
library(plotly)
library(tidyverse)
library(psych)
library(Matching)
library(causaldata)
library(dplyr)
library(rgenoud)
library(MatchIt)
library(optmatch)
library(Rglpk)
library(lemon)
library(reshape2)
library(kableExtra)
knit_print.data.frame <- lemon_print

data <- read_dta('../Datos/PBF_municipios_long_2.dta')
```

## Bolsa Familia

El Programa Bolsa Familia (PBF) es un programa de transferencias monetarias que tiene como fin apoyar a las familias en condición de pobreza o pobreza extrema. Igualmente, este pograma busca aumentar el acceso a servicios de salud y educación. El programa fue implementado por el gobierno de Brasil en Octube de 2003 y gracias a el éxito observado ha sido elogiado por reducir la pobreza y la desigualdad en Brasil, y se ha expandido con el paso de los años para incluir a más personas.En junio de 2015, cerca del 25% de la población brasileña, es decir, 13.827.369 familias, se habían beneficiado del PBF. A pesar de su gran alcance, el programa tiene un impacto financiero moderado en el presupuesto del país, ya que representa solo el 0.45% del Producto Interno Bruto brasileño.

PBF ha sido ampliamente reconocido como una estrategia exitosa en la lucha contra el hambre y la pobreza en Brasil. En 2014, la Organización de las Naciones Unidas para la Alimentación y la Agricultura (FAO) destacó el papel del programa en la reducción de la inseguridad alimentaria y la pobreza extrema en el país. Según la FAO, el programa ha sido crucial para mejorar el acceso a alimentos para las poblaciones más vulnerables, especialmente las mujeres y los niños.


### Eligibilidad

 
Para ser elegibles, las familias deben tener ingresos mensuales inferiores a 154 reales por persona (alrededor de $550 pesos mexicanos a mayo de 2023). Es importante destacar que se considera "familia" a una unidad básica que puede estar compuesta por individuos con o sin parentesco que comparten una misma vivienda. De esta manera, el programa se enfoca en ayudar a las personas que se encuentran en una situación vulnerable y requieren de apoyo financiero para cubrir sus necesidades básicas.

El número de familias que pueden ingresar al Programa Bolsa Familia en cada municipio está limitado por una estimación previa del número de familias pobres en el área. Esta estimación se realiza a partir de los datos del Censo Demográfico y de la Encuesta Nacional por Muestras de Domicilios, ambos ejecutados por el Instituto Brasileño de Geografía y Estadística (IBGE). 

El acceso al Programa Bolsa Familia comienza con las familias consideradas prioritarias, como las familias quilombolas (pertenecientes a antiguas comunidades de afro-brasileros), indígenas, las familias que obtienen sus ingresos del reciclaje de basura o familias en las que se ha identificado tanto trabajo infantil como situaciones análogas a esclavitud. Estas familias tienen un acceso garantizado, independientemente de si se ha alcanzado o no el límite municipal. Después de asignar cupos a estas familias prioritarias, se asignan los cupos restantes a las familias con menor ingreso mensual por persona. Cuando hay paridad de ingresos, se priorizan las familias con mayor número de niños y adolescentes menores de 18 años.

Las familias podrían perder su vinculación con el programa en caso de: (a) no cumplir de manera repetitiva con los requisitos de salud y educación; (b) superar la línea de pobreza debido a un aumento de sus ingresos, o (c) no actualizar su información en el Cadastro Único.

Cuando una familia sobrepasa la línea de pobreza pero sigue por debajo de medio salario mínimo mensual per cápita, no se les cancelan las transferencias inmediatamente. En su lugar, se les extienden los beneficios por dos años para garantizar que las mejoras económicas sean sostenibles. Luego de este plazo, se reevalúa la situación de la familia y, si sus ingresos siguen por encima de los límites del programa o la familia no actualiza su información, se cancelan los beneficios. Si una familia desea desvincularse voluntariamente del programa, puede hacerlo y, en caso de que sus ingresos disminuyan de nuevo, tiene derecho a volver al programa dentro de los 36 meses siguientes.
 
 
### Transferencias
 
 
Existen cuatro tipos de transferencias que varían según la situación y composición de cada familia:

* Beneficio básico: consiste en la entrega de 77 reales mensuales y está dirigido exclusivamente a familias que se encuentran en extrema pobreza en Brasil, lo que significa que su ingreso mensual por persona es menor a 77 reales. Este beneficio es independiente de la composición familiar y puede ser recibido incluso si no hay individuos menores de 18 años.

* Beneficio variable: consiste en la entrega de 35 reales y está destinado a las familias en situación de pobreza o extrema pobreza que tienen mujeres embarazadas o en etapa de lactancia, así como también niños y adolescentes de hasta 15 años en su composición familiar. Cada familia puede recibir hasta cinco beneficios variables, uno por cada individuo elegible.

* Beneficio variable joven: consiste en la entrega de 42 reales y está destinado a las familias en situación de pobreza o extrema pobreza que tienen jóvenes de entre 16 y 17 años en su composición familiar. Cada familia puede recibir hasta dos beneficios variables jóvenes. Este beneficio se otorga hasta el mes de diciembre del año en que el adolescente cumple 18 años.

* Beneficio superación de la pobreza: es una ayuda financiera adicional del Programa Bolsa Familia y está destinado a las familias que, a pesar de recibir los demás beneficios correspondientes a su composición familiar, todavía no logran superar la línea de extrema pobreza. Este beneficio se otorga de manera personalizada para cada situación familiar y se calcula para que la familia pueda alcanzar los 77 reales por persona.


#### Datos y análisis estadístico.  


Las variables que se usarán para realizar el análisis son: 

  * `pc_pbf_pop`: porcentaje de población del PBF en el municipio.
  * `acomp_freq`: tasa de seguimiento de la condicionalidad de la asistencia escolar (6 a 15 años).
  * `ab_ef`: Tasa de deserción en la escuela primaria - 0 a 100.
  * `ap_ef` : Tasa de aprobación en la escuela primaria.
  * `cobalvoPBF` : Porcentaje de cobertura del público objetivo del PBF Fundamental.
  * `porteIBGE` : Tamaño del municipio - población.   
  * `rdpc_2010` : Renta per cápita según Censo 2010.
  * `infraescolar_em_2011` : Indicador de infraestructura de las escuelas de EM en el municipio - continuo.
  * `infraescolar_ef_2011` : Indicador de infraestructura de las escuelas de EF en el municipio - continuo.
  * `propextpobre_2010` : Proporción de la población extremadamente pobre.
  * `rep_ef` : tasa de fracaso en la escuela primaria.
  * `rep_em` : tasa de fracaso en la escuela primaria.
  * `tesouro` : Transferencias totales del tesoro nacional.
  * `est_fam_PBF_2006` : Estimación de familias PBF - 2006 (Hasta 140.00 renta per cápita).
  * `est_fam_PBF_2010` : Estimación de familias PBF - 2010 (Hasta 140.00 renta per cápita).
  * `ano` : Año de la estimación.
  * `agua_esgoto_inadeq_2010` : Porcentaje de personas en hogares con suministro de agua y alcantarillado inadecuados.
  * `pc_lixo_2010` : Porcentaje de población en viviendas con recolección de basura.
  * `pc_luz_2010` : Porcentaje de población en hogares con electricidad.
  * `PIBcapita` : PIB municipal por capita.
  * `PIB` : PIB municipal.
  * `IDHM_E_2010` : IDH-M en 2010 - educación.
  * `IDHM_L_2010` : IDH-M en 2010 - longevidad.
  * `IDHM_R_2010` : IDH-M en 2010 - ingresos.
  * `pbf_capita` : Valor de transferencias PBF per cápita
  * `alunospbf` : Número de alumnos en PBF
  * `fam_pbf` : Número de familias beneficiarias de PBF
  * `pbf_valor` : Valor de transferencias PBF

```{r echo=FALSE}

#Eliminar columnas inecesarias para el análisis. 

interest_vars <- c('pc_pbf_pop','acomp_freq','ab_ef','ap_ef','cobalvoPBF','porteIBGE','rdpc_2010', 'infraescolar_ef_2011','infraescolar_em_2011','propextpobre_2010','rep_ef','rep_em','tesouro','est_fam_PBF_2006','est_fam_PBF_2010','ano','agua_esgoto_inadeq_2010','pc_lixo_2010','pc_luz_2010','PIBcapita','PIB','IDHM_E_2010','IDHM_L_2010','IDHM_R_2010','pbf_capita', 'alunospbf', 'fam_pbf')

interest_vars <- tolower(interest_vars)

treatment_vars_percentage <- c('pc_pbf_pop','cobalvopbf')

colnames(data) <- tolower(colnames(data))

data <- data %>% subset(select = interest_vars)

data_treatment_percentage <- data %>% subset(select = treatment_vars_percentage) %>% melt(value.name = 'porcentaje')
```

```{r echo = FALSE}
summary <- summary(data) %>% t()
summary <- as.data.frame.matrix(summary)
colnames(summary) <- c('Min','1st Qu', 'Mediana', 'Media', '3rd Qu', 'Max', 'NAs')
summary <- summary %>% subset(select = c('Min','1st Qu', 'Mediana', 'Media', '3rd Qu', 'Max'))
summary <- summary %>% mutate_all(~sub(".*:", "", .))
summary[] <- lapply(summary, as.double)

# Use format() to format the numbers with commas and no exponential notation
summary[] <- lapply(summary, function(x) if(is.numeric(x)) format(round(x, 2), big.mark=",", scientific=FALSE) else x)

#knitr::kable(summary, caption='Resumen de las variables', align = 'c', format = 'pipe', digits = 2,text.size = "10pt")

kable(summary, caption = 'Resumen de las variables', align = 'c', format = 'latex', digits = 2, booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position", font_size = 8)

```

```{r echo=FALSE}
hist <- ggplot(data_treatment_percentage, aes(x = porcentaje, fill = variable, alpha =  variable)) + 
  geom_histogram(bins =100,position = "identity") + 
  labs(title = 'Histograma de Cobertura de PBF por Municipio', x = '% de población en PBF por municipio', y = 'Número de municipios' ) + theme_minimal() + 
  theme(panel.border = element_blank(),plot.title = element_text(hjust = 0.5)) + xlim(0, 250) + scale_alpha_manual(values = c(0.8, 0.8), guide = FALSE)

# hist <- ggplot(data, aes(x = pc_pbf_pop)) + 
#   geom_histogram(bins =100,fill = "#1f77b4") + 
#   labs(title = 'Histograma de Cobertura de PBF por Municipio', x = '% de población en PBF por municipio', y = 'Número de municipios' ) + theme_minimal() + 
#   theme(panel.border = element_blank(),plot.title = element_text(hjust = 0.5))

box <- ggplot(data_treatment_percentage, aes(x = variable, y = porcentaje)) + 
  geom_boxplot(fill = "#1f77b4") + 
  labs(title = 'Distribución de Cobertura de PBF por Municipio' ) + theme_minimal() +
  theme(panel.border = element_blank(),plot.title = element_text(hjust = 0.5)) + ylim(0,250)

# box <- ggplot(data, aes(x = pc_pbf_pop)) + 
#   geom_boxplot(fill = "#1f77b4") + 
#   labs(title = 'Distribución de Cobertura de PBF por Municipio' ) + theme_minimal() +
#   theme(panel.border = element_blank(),plot.title = element_text(hjust = 0.5))

plot_grid(hist, ncol = 1,align = 'v',height = 10)

plot_grid(box, ncol = 1,align = 'v',height = 10)

```


```{r}
alpha <- 32.5#mean(data$pc_pbf_pop)

data$treatment_dummy <- ifelse(data$pc_pbf_pop > alpha, 1, 0)
#Treatment and control plot
ggplot(data,aes(x=treatment_dummy)) +geom_bar()
```


#### 

#### Referencias


https://publications.iadb.org/publications/spanish/viewer/S%C3%ADntesis-del-programa-Bolsa-Familia-en-Brasil.pdf


