---
output:
    pdf_document:
      fig_caption: true
      number_sections: true
    html_document:
      toc: true
      theme: united
header-includes:
  - \usepackage{pdfpages}
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhf{}
  - \fancyfoot[C]{\thepage}
  - \renewcommand{\headrulewidth}{0pt}
  - \setlength{\headheight}{15pt}
  - \usepackage[spanish]{babel}
---

\newpage
\thispagestyle{empty}
\vspace*{2.5cm}
\begin{center}
\textbf{\Huge Evaluación de Bolsa Familia}
\vspace{1.5cm}

\vspace{1.5cm}
{\Large Proyecto Final de Tópicos de Políticas Públicas II}
\vspace{0.5cm}

\vspace{0.5cm}
\Large Guillermo Naranjo, Rodolfo Gloria, Sebastian Dulong y Javier Nieto
\vspace{1.5cm}

\includegraphics[width=6cm]{itam.png}

\vfill
15 de mayo del 2023
\end{center}
\newpage
\tableofcontents
\listoftables
\newpage
```{r setup, include=FALSE, echo=FALSE}
library(haven)
library(ggplot2)
library(gridExtra)
library(cowplot)
library(scales)
library(orca)
library(plotly)
library(tidyverse)
library(psych)
library(Matching)
library(causaldata)
library(dplyr)
library(rgenoud)
library(MatchIt)
library(plm)
library(optmatch)
library(Rglpk)
library(lemon)
library(reshape2)
library(kableExtra)
library(cobalt)
library(stargazer)
library(knitr)


knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

# Bolsa Familia

El Programa Bolsa Familia (PBF) es un programa de transferencias monetarias que tiene como fin apoyar a las familias en condición de pobreza o pobreza extrema, esto se hace mediante transferencias que buscan tener un impacto positivo en los niveles de salud y educación de los beneficiarios. El programa fue implementado por el gobierno de Brasil en Octube de 2003 y gracias a el éxito observado ha sido elogiado por reducir la pobreza y la desigualdad en Brasil, y se ha expandido con el paso de los años para incluir a más personas.En junio de 2015, cerca del 25% de la población brasileña, es decir, 13,827,369 familias, se habían beneficiado del PBF. A pesar de su gran alcance, el programa tiene un impacto financiero moderado en el presupuesto del país, ya que representa solo el 0.45% del Producto Interno Bruto brasileño.

PBF ha sido ampliamente reconocido como una estrategia exitosa en la lucha contra el hambre y la pobreza en Brasil. En 2014, la Organización de las Naciones Unidas para la Alimentación y la Agricultura (FAO) destacó el papel del programa en la reducción de la inseguridad alimentaria y la pobreza extrema en el país. Según la FAO, el programa ha sido crucial para mejorar el acceso a alimentos para las poblaciones más vulnerables, especialmente las mujeres y los niños.

## Eligibilidad

Para ser elegibles, las familias deben tener ingresos mensuales inferiores a 154 reales por persona (alrededor de \$550 pesos mexicanos a mayo de 2023). Es importante destacar que se considera "familia" a una unidad básica que puede estar compuesta por individuos con o sin parentesco que comparten una misma vivienda. De esta manera, el programa se enfoca en ayudar a las personas que se encuentran en una situación vulnerable y requieren de apoyo financiero para cubrir sus necesidades básicas.

El número de familias que pueden ingresar al Programa Bolsa Familia en cada municipio está limitado por una estimación previa del número de familias pobres en el área. Esta estimación se realiza a partir de los datos del Censo Demográfico y de la Encuesta Nacional por Muestras de Domicilios, ambos ejecutados por el Instituto Brasileño de Geografía y Estadística (IBGE).

El acceso al Programa Bolsa Familia comienza con las familias consideradas prioritarias, como las familias quilombolas (pertenecientes a antiguas comunidades de afro-brasileros), familias indígenas, familias que obtienen sus ingresos del reciclaje de basura o familias en las que se ha identificado tanto trabajo infantil como situaciones análogas a esclavitud. Estas familias tienen un acceso garantizado, independientemente de si se ha alcanzado o no el límite municipal. Después de asignar cupos a estas familias prioritarias, se asignan los cupos restantes a las familias con menor ingreso mensual por persona. Cuando hay paridad de ingresos, se priorizan las familias con mayor número de niños y adolescentes menores de 18 años.

Las familias podrían perder su vinculación con el programa en caso de:

1.  No cumplen de manera repetitiva con los requisitos de salud y educación.
2.  Superen la línea de pobreza debido a un aumento de sus ingresos.
3.  No actualicen su información en el Cadastro Único.

Cuando una familia sobrepasa la línea de pobreza pero sigue por debajo de medio salario mínimo mensual per cápita, no se les cancelan las transferencias inmediatamente. En su lugar, se les extienden los beneficios por dos años para garantizar que las mejoras económicas sean sostenibles. Luego de este plazo, se reevalúa la situación de la familia y, si sus ingresos siguen por encima de los límites del programa o la familia no actualiza su información, se cancelan los beneficios. Si una familia desea desvincularse voluntariamente del programa, puede hacerlo y, en caso de que sus ingresos disminuyan de nuevo, tiene derecho a volver al programa dentro de los 36 meses siguientes.

## Transferencias

Existen cuatro tipos de transferencias que varían según la situación y composición de cada familia:

-   Beneficio básico: consiste en la entrega de 77 reales mensuales y está dirigido exclusivamente a familias que se encuentran en extrema pobreza en Brasil, lo que significa que su ingreso mensual por persona es menor a 77 reales. Este beneficio es independiente de la composición familiar y puede ser recibido incluso si no hay individuos menores de 18 años.

-   Beneficio variable: consiste en la entrega de 35 reales y está destinado a las familias en situación de pobreza o extrema pobreza que tienen mujeres embarazadas o en etapa de lactancia, así como también niños y adolescentes de hasta 15 años en su composición familiar. Cada familia puede recibir hasta cinco beneficios variables, uno por cada individuo elegible.

-   Beneficio variable joven: consiste en la entrega de 42 reales y está destinado a las familias en situación de pobreza o extrema pobreza que tienen jóvenes de entre 16 y 17 años en su composición familiar. Cada familia puede recibir hasta dos beneficios variables jóvenes. Este beneficio se otorga hasta el mes de diciembre del año en que el adolescente cumple 18 años.

-   Beneficio superación de la pobreza: es una ayuda financiera adicional del Programa Bolsa Familia y está destinado a las familias que, a pesar de recibir los demás beneficios correspondientes a su composición familiar, todavía no logran superar la línea de extrema pobreza. Este beneficio se otorga de manera personalizada para cada situación familiar y se calcula para que la familia pueda alcanzar los 77 reales por persona.
 
# Datos y análisis estadístico

El análisis de impacto del Programa Bolsa Familia de Brasil se basa en una amplia base de datos que abarca 27 estados y 5,283 municipios en los que se implementó el programa. La disponibilidad de estas cifras permite una evaluación detallada del desempeño del programa en cada uno de los municipios. Entre las variables disponibles para el análisis se encuentran: el número de familias beneficiadas, el número de alumnos beneficiados, la tasa de cobertura, la tasa de cobertura de población en extrema pobreza, la tasa de deserción escolar, el desempeño en educación primaria y secundaria, y el Índice de Desarrollo Humano, desglosado en sus componentes de educación, ingresos y longevidad (salud). Estos datos permiten evaluar el impacto del programa en las dimensiones de educación y salud, lo que a su vez permitirá una comprensión más completa de su efectividad en la lucha contra la pobreza y la desigualdad en Brasil.

\newpage
```{r echo = FALSE}
df <- data.frame(
  Variable = c("pc_pbf_pop","pc_alunosPBF", "acomp_freq", "ab_ef", "ap_ef", "cobalvopbf", "porteIBGE", "rdpc_2010", "infraescolar_em_2011", "infraescolar_ef_2011", "propextpobre_2010", "rep_ef", "rep_em", "tesouro", "est_fam_PBF_2006", "est_fam_PBF_2010", "ano", "agua_esgoto_inadeq_2010", "pc_lixo_2010", "pc_luz_2010", "PIBcapita", "PIB", "IDHM_E_2010", "IDHM_L_2010", "IDHM_R_2010", "pbf_capita", "alunospbf", "fam_pbf", "pbf_valor", "PIB_agropec", "PIB_servicios", "PIB_industria", "nome_municipio"),
  Descripcion = c("Porcentaje de población del PBF en el municipio", "Porcentaje de alumnos del municipio que participan en PBF","Tasa de seguimiento de la condicionalidad de la asistencia escolar (6 a 15 años)", "Tasa de deserción en la escuela primaria - 0 a 100", "Tasa de aprobación en la escuela primaria", "Porcentaje de cobertura del público objetivo del PBF Fundamental", "Tamaño del municipio - población", "Renta per cápita según Censo 2010", "Indicador de infraestructura de las escuelas de EM en el municipio - continuo", "Indicador de infraestructura de las escuelas de EF en el municipio - continuo", "Proporción de la población extremadamente pobre", "Tasa de fracaso en la escuela primaria", "Tasa de fracaso en la escuela primaria", "Transferencias totales del tesoro nacional", "Estimación de familias PBF - 2006 (Hasta 140.00 renta per cápita)", "Estimación de familias PBF - 2010 (Hasta 140.00 renta per cápita)", "Año de la estimación", "Porcentaje de personas en hogares con suministro de agua y alcantarillado inadecuados", "Porcentaje de población en viviendas con recolección de basura", "Porcentaje de población en hogares con electricidad", "PIB municipal por capita", "PIB municipal", "IDH-M en 2010 - educación", "IDH-M en 2010 - longevidad", "IDH-M en 2010 - ingresos", "Valor de transferencias PBF per cápita", "Número de alumnos en PBF", "Número de familias beneficiarias de PBF", "Valor de transferencias PBF", "PIB del sector agropecuario del municipio", "PIB del sector servicios del municipio", "PIB de las industrias del municipio", "Nombre del municipio")
)

kable(df, align = "ll", caption = "Descripción de variables", format = 'latex', booktabs = TRUE) %>% 
  kable_styling(latex_options = "hold_position", font_size = 8)
```



```{r echo=FALSE}

#Eliminar columnas inecesarias para el análisis. 
data <- read_dta('../Datos/PBF_municipios_long_2.dta')

interest_vars <- c('pc_pbf_pop','acomp_freq','ab_ef','ap_ef','cobalvoPBF','porteIBGE','rdpc_2010', 'infraescolar_ef_2011','infraescolar_em_2011','propextpobre_2010','rep_ef','rep_em','tesouro','est_fam_PBF_2006','est_fam_PBF_2010','ano','agua_esgoto_inadeq_2010','pc_lixo_2010','pc_luz_2010','PIBcapita','PIB','IDHM_E_2010','IDHM_L_2010','IDHM_R_2010','pbf_capita', 'alunospbf', 'fam_pbf', 'pc_alunosPBF', 'PIB_industria', 'PIB_servicos', 'PIB_agropec', 'nome_municipio','cobalvopbf', 'pbf_valor')


interest_vars <- tolower(interest_vars)

treatment_vars_percentage <- c('pc_pbf_pop','cobalvopbf')

colnames(data) <- tolower(colnames(data))

data <- data %>% subset(select = interest_vars)

data_treatment_percentage <- data %>% subset(select = treatment_vars_percentage) %>% melt(value.name = 'porcentaje')
```

```{r echo = FALSE}
summary <- summary(data) %>% t()
summary <- as.data.frame.matrix(summary)
colnames(summary) <- c('Min','1st Qu', 'Mediana', 'Media', '3rd Qu', 'Max', 'NAs')
summary <- summary %>% subset(select = c('Min','1st Qu', 'Mediana', 'Media', '3rd Qu', 'Max'))
summary <- summary %>% mutate_all(~sub(".*:", "", .))
summary[] <- lapply(summary, as.double)

# Use format() to format the numbers with commas and no exponential notation
summary[] <- lapply(summary, function(x) if(is.numeric(x)) format(round(x, 2), big.mark=",", scientific=FALSE) else x)

#knitr::kable(summary, caption='Resumen de las variables', align = 'c', format = 'pipe', digits = 2,text.size = "10pt")

kable(summary, caption = 'Resumen de las variables', align = 'c', format = 'latex', digits = 2, booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position", font_size = 8)
```

\newpage

```{r echo = FALSE, fig.width=9, fig.height=4, fig.show="hold"}
hist <- ggplot(data_treatment_percentage, aes(x = porcentaje, fill = variable, alpha =  variable)) + 
  geom_histogram(bins =100,position = "identity") + 
  labs(title = 'Histograma de Cobertura de PBF por Municipio', x = 'Población en PBF por familia (%)', y = 'Número de municipios' ) + theme_minimal() + 
  theme(panel.border = element_blank(),plot.title = element_text(hjust = 0.5)) + xlim(0, 250) + scale_alpha_manual(values = c(0.8, 0.8), guide = FALSE)

print(hist)
```

```{r echo = FALSE, fig.width=9, fig.height=4}
box <- ggplot(data_treatment_percentage, aes(x = variable, y = porcentaje)) + 
  geom_boxplot(fill = "#1f77b4") + 
  labs(title = 'Distribución de Cobertura de PBF por Municipio', x = 'Porcentaje (%)') + theme_minimal() +
  theme(panel.border = element_blank(),plot.title = element_text(hjust = 0.5)) + ylim(0,250)

print(box)
```

\newpage

# Efectos Fijos

La evaluación rigurosa del programa Bolsa Familia a nivel municipal es esencial para comprender su efectividad y determinar su impacto en la reducción de la pobreza y la promoción de la inclusión social. En este sentido, la regresión de efectos fijos con datos de panel se destaca como una valiosa herramienta de análisis. Esta técnica permite controlar por factores no observados, como características socioeconómicas y culturales específicas de cada municipio, que podrían influir en los resultados del programa. Al incluir los efectos fijos municipales en el modelo de regresión, se elimina la influencia de estos factores constantes a lo largo del tiempo, lo que proporciona una estimación más precisa del impacto real de Bolsa Familia en cada contexto local.

Se utilizará la regresión de efectos fijos para examinar el impacto de factores específicos en la salud, la educación y la pobreza en cada municipio. Mediante la inclusión de efectos fijos municipales en el análisis, se controlará por características propias de cada municipio que permanecen constantes a lo largo del tiempo. Esto nos permitirá determinar de manera más precisa cómo variables como la inversión en infraestructura, el acceso a servicios educativos, los indicadores de salud, el nivel de ingresos y otros factores relevantes influyen en los resultados relacionados con la salud, la educación y la pobreza.

1. Índice de Deserción Escolar: El índice de deserción escolar es un indicador clave para medir la capacidad del programa para retener a los estudiantes en el sistema educativo. Un índice de deserción escolar más bajo sugiere que el programa está logrando reducir la tasa de abandono escolar, lo cual es esencial para garantizar que los estudiantes beneficiarios puedan completar su educación y tener mayores oportunidades en el futuro.

2. PIB per cápita: Esta variable permite evaluar el impacto del programa en el bienestar económico de los beneficiarios y en la reducción de la pobreza. Un incremento en el el PIB per cápita indicaría que el programa está logrando mejorar las condiciones económicas de las familias beneficiarias, lo cual es un objetivo central de Bolsa Familia.

3. Índice de Desarrollo Humano relacionado con la Salud: El índice de desarrollo humano relacionado con la salud es esencial para evaluar cómo el programa contribuye a mejorar el acceso a servicios de salud y promover una mejor calidad de vida. Un aumento en este índice indicaría que el programa está impactando positivamente en la salud de los beneficiarios, garantizando un acceso adecuado a servicios de atención médica y mejorando su bienestar general.

En resumen, estas variables nos permitirán medir y evaluar el impacto del programa Bolsa Familia en las tres áreas clave: salud, educación e ingresos. El análisis de estas variables proporcionará información valiosa sobre cómo el programa está contribuyendo al mejoramiento de la salud de los beneficiarios, su rendimiento educativo y su bienestar económico.


```{r echo = FALSE, include = FALSE}
###Ver efectos fijos en: 

#Cuando todas las dummies son 0, entonces es el año 2008.
fixed_effects <- data %>% subset(select = c('pc_pbf_pop','ap_ef','ab_ef','idhm_l_2010','rep_ef','cobalvopbf','porteibge','pib_industria','pib_servicos','pib_agropec', 'pbf_capita', 'pc_alunospbf','pbf_valor','pibcapita'))
fixed_effects <- as.data.frame(scale(fixed_effects))
fixed_effects$ano <-  data$ano
fixed_effects$nome_municipio <- data$nome_municipio

#Usar como variable objetivo idh
model_IDH <- plm(formula = idhm_l_2010 ~ cobalvopbf + pc_pbf_pop + pc_alunospbf + pbf_valor + pbf_capita + porteibge + pib_industria + pib_servicos + pib_agropec,
              data = fixed_effects,
              index = c("nome_municipio","ano"),
              model = "within", effect = "individual")

#Usar como variable objetivo la deserción escolar
model_desercion_esc <- plm(formula = ab_ef ~ cobalvopbf + pc_pbf_pop + pc_alunospbf + pbf_valor + pbf_capita + porteibge + pib_industria + pib_servicos + pib_agropec,
              data = fixed_effects,
              index = c("nome_municipio","ano"), 
              model = "within", effect = "individual")

#Usar como variable objetivo la aprobación escolar
model_aprobacion_esc <- plm(formula = ap_ef ~ cobalvopbf + pc_pbf_pop + pc_alunospbf + pbf_valor + pbf_capita + porteibge + pib_industria + pib_servicos + pib_agropec,
              data = fixed_effects,
              index = c("nome_municipio","ano"), 
              model = "within", effect = "individual")

#Usar como variable objetivo el pib per capita
model_pib_capita <- plm(formula = pibcapita ~ cobalvopbf + pc_pbf_pop + pc_alunospbf + pbf_valor + pbf_capita + porteibge + pib_industria + pib_servicos + pib_agropec,
              data = fixed_effects,
              index = c("nome_municipio","ano"), 
              model = "within", effect = "individual")

#Se incluyen en el resumen modelos para describir ingresos, deserción escolar y salud.
stargazer(model_desercion_esc,model_pib_capita,model_IDH, ci = TRUE ,type = 'latex', title = "Resumen del modelo")
```
\newpage
\begin{table}[!htbp] \centering 
  \caption{Resumen de los modelos} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{3}{c}{\textit{Variable dependiente:}} \\ 
\cline{2-4} 
\\[-1.8ex] & Deserción escolar & PIB capita & IDH longevidad \\ 
\\[-1.8ex] & (1) & (2) & (3)\\ 
\hline \\[-1.8ex] 
 cobalvopbf & $-$0.077$^{***}$ & 0.033$^{***}$ & 0.044$^{***}$ \\ 
  & ($-$0.087, $-$0.067) & (0.026, 0.040) & (0.040, 0.047) \\ 
  & & & \\ 
 pc\_pbf\_pop & $-$0.118$^{***}$ & $-$0.046$^{***}$ & $-$0.359$^{***}$ \\ 
  & ($-$0.147, $-$0.089) & ($-$0.066, $-$0.026) & ($-$0.370, $-$0.348) \\ 
  & & & \\ 
 pc\_alunospbf & 0.372$^{***}$ & $-$0.211$^{***}$ & $-$0.218$^{***}$ \\ 
  & (0.345, 0.400) & ($-$0.230, $-$0.192) & ($-$0.228, $-$0.208) \\ 
  & & & \\ 
 pbf\_valor & $-$0.100$^{***}$ & $-$0.094$^{***}$ & 0.036$^{***}$ \\ 
  & ($-$0.124, $-$0.076) & ($-$0.111, $-$0.077) & (0.027, 0.045) \\ 
  & & & \\ 
 pbf\_capita & $-$0.135$^{***}$ & 0.093$^{***}$ & 0.019$^{***}$ \\ 
  & ($-$0.143, $-$0.127) & (0.087, 0.098) & (0.017, 0.022) \\ 
  & & & \\ 
 porteibge & 0.047$^{***}$ & $-$0.001 & 0.019$^{***}$ \\ 
  & (0.020, 0.074) & ($-$0.019, 0.018) & (0.009, 0.029) \\ 
  & & & \\ 
 pib\_industria & $-$0.062$^{**}$ & 1.475$^{***}$ & 0.058$^{***}$ \\ 
  & ($-$0.109, $-$0.014) & (1.442, 1.508) & (0.040, 0.075) \\ 
  & & & \\ 
 pib\_servicos & 0.108$^{***}$ & $-$0.723$^{***}$ & $-$0.045$^{***}$ \\ 
  & (0.042, 0.174) & ($-$0.769, $-$0.677) & ($-$0.069, $-$0.021) \\ 
  & & & \\ 
 pib\_agropec & $-$0.063$^{***}$ & 0.213$^{***}$ & 0.041$^{***}$ \\ 
  & ($-$0.085, $-$0.041) & (0.197, 0.228) & (0.032, 0.049) \\ 
  & & & \\ 
\hline \\[-1.8ex] 
Observaciones & 27,795 & 27,820 & 27,820 \\ 
R$^{2}$ & 0.117 & 0.359 & 0.442 \\ 
R$^{2}$ Ajustada & $-$0.091 & 0.208 & 0.312 \\ 
Estadístico F & 331.368$^{***}$ (df = 9; 22504) & 1,398.981$^{***}$ (df = 9; 22529) & 1,986.522$^{***}$ (df = 9; 22529) \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Nota:}  & \multicolumn{3}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table}
 
## Resultados

Los resultados de las regresiones de efectos fijos nos indican que las variables de porcentaje de cobertura de población fundamental (cobalvopbf), transferencias de bolsa familia per cápita (pbf_capita), PIB de la industria (pib_industria) y PIB agropecuario (pib_agropec) tienen el efecto esperado hacia las variables de educación, salud e ingresos. Estas tres variables son las que tienen efectos acorde a lo que se esperaba con las variables dependientes.

Para las variables como porcentaje de alumnos en Bolsa Familia (pc_alunos_pbf) y PIB de Servicios (pib_servicos) se econtró que existe una relación contraria a la que se desea para las variables de salud, ingreso y educación. Conforme ambas variables aumentan, se observa que hay mayor deserción escolar y tanto el PIB per cápita como el IDH bajan.

En resumen, los resultados de las regresiones de efectos fijos revelan efectos positivos esperados en variables como cobertura de población fundamental, transferencias per cápita, PIB de la industria y PIB agropecuario, en relación con educación, salud e ingresos. Sin embargo, también se observaron relaciones contrarias a lo esperado en variables como porcentaje de alumnos en Bolsa Familia y PIB de servicios. Estos hallazgos indican la necesidad de realizar análisis adicionales para comprender mejor las dinámicas subyacentes y maximizar los beneficios del programa Bolsa Familia en todas las áreas.

# Matching

Para la evaluación de Bolsa Familia, nos enfrentamos con el problema de no tener una variable de tratamiento como tal. Es decir, no teníamos forma de conseguir los datos de cada estudiante de Brasil, y si participó o no en el programa. De alguna forma, necesitamos esto para poder comparar entre un grupo de tratamiento y uno de control, y poder aplicar con esta información distintos modelos que nos digan el impacto de la política pública.

Ante este problema, usamos Matching, un método que nos permite asociar municipios a clusters (o grupos) con los que comparten similitudes, conteniendo una proporción similar de municipios tratados y no tratados. Entonces, se necesita una variable de tratamiento y variables que sirvan como covariadas para poder relacionar municipios entre sí que tengan probabilidades similares de ser tratados. A esto, le llamaremos puntaje de propensión. El matching se realizaría con todos los municipios únicamente del 2008, año de inicio del dataset, para poder llevar un rastreo de su desempeño a lo largo de 4 años.

## Variable de tratamiento


Pero, ¿cómo conseguimos una variable de tratamiento? Para esto, reunimos las siguientes variables con datos anuales por cada uno de los municipios:

-   pc_pbf_pob: porcentaje de la población que participa en PBF del municipio
-   covalbopbf: porcentaje de cobertura del público objetivo del PBF fundamental
-   pc_alunospbf: porcentaje de alumnos del municipio en PBF

De este modo, asignamos con un 0 (no tratados) a aquellos municipios que no superaran la mediana de la muestra total de todos los municipios registrados en 2008 para las tres variables, y con un 1 a los que sí. Para esto, se excluyó una muestra considerablemente pequeña de municipios que no contaban con información suficiente para ser participar en el matching.


## Covariadas


Para las variables covariadas que nos ayuden a enconrtar similitudes entre los municipios, usamos las siguientes 4, que creemos dan una imagen general de la situación y contexto de cada municipio:

-   portel_IBGE: tamaño del municipio (población)
-   PIB_agropec: PIB agropecuario municipal del año
-   PIB_servicos: PIB del sector servicios municipal del año
-   PIB_industria: PIB de la industria del municipio del año

Finalmente, se hizo el proceso de matching con la librería de MatchIt de R, usando el método de K-vecinos cercanos, con n= 1. Es decir, por cada municipio tratado, se le asignó un municipio de características similares, pero con tratamiento por debajo de la mediana.

Antes del matching, se empezó con un total de 5565 municipios, y tras haber terminado este proceso, quedamos con un total de 5475, lo cual sigue siendo una muestra muy completa.

```{r echo=FALSE}

# Subset del df; valores del 2008
df_2008 <- data[data$ano == 2008, ]

# Número de municipios antes del matching
# nrow(df_2008)

df_2008 <- df_2008[complete.cases(df_2008[,c("pc_pbf_pop", "cobalvopbf", "pc_alunospbf", "pib_agropec", "pib_servicos", "pib_industria", "porteibge")]), ]

# Create the variable of treatment (only one) for those greater than the mean
treatment <- as.numeric(rowMeans(df_2008[,c("pc_pbf_pop", "cobalvopbf", "pc_alunospbf")], na.rm = TRUE) > median(rowMeans(df_2008[,c("pc_pbf_pop", "cobalvopbf", "pc_alunospbf")], na.rm = TRUE)))
df_2008 <- na.omit(cbind(df_2008, treatment))

# Create the formula for matching
psmodel <- c("pib_agropec", "pib_servicos", "pib_industria", "porteibge")

psformula <- formula(paste("treatment ~", paste(psmodel, collapse = "+")))

# Create the matching object
m.out <- matchit(psformula, data = df_2008, method = "nearest", distance = "logit", ratio = 1)

# Create the matched dataset
data_matched <- match.data(m.out)

# Número de municipios al final del matching
# nrow(data_matched)

```
A continuación, mostramos las gráficas de la distribución del puntaje de propensión antes y después de hacer matching. Se puede apreciar que ambas distribuciones son extremadamente similares. En un trabajo de Aprendizaje de Máquina, esto nos preocuparía, ya que nos indicaría que nuestro modelo está sobreajustado. No obstante, en este contexto es muy favorable. Como usamos K-vecinos cercanos únicamente para encontrar municipios parecidos a los tratados, pero sin tratamiento, y no para predecir a qué categoría pertenecerían nuevos municipios, el modelo funcionó perfectamente. Es decir, los municipios tratados y los no tratados tienen muy alta similitud, lo cual nos ayudará a medir los efectos del programa de muy buena manera.
```{r fig.align="center", echo=FALSE, fig.width=9, fig.height=4}

# Create data frame with propensity score and matching indicator
ps_data <- data.frame(distance = c(m.out$distance, match.data(m.out)$distance),
                      match = c(rep("Before Matching", length(m.out$distance)), 
                                rep("After Matching", length(match.data(m.out)$distance))))

# Create histogram with density curves
ggplot(ps_data, aes(x = distance, fill = match)) +
  geom_histogram(alpha = 0.5, position = "identity", bins = 20) +
  geom_density(alpha = 0.5) +
  labs(x = "Puntaje de propensión", y = "Densidad", fill = "Matching") +
  ggtitle("Puntaje de propensión antes y después de Matching") +
  theme_minimal() +
  facet_wrap(~ match, ncol = 2, scales = "free_x") +
  theme(plot.margin = unit(c(2, 2,2,2), "cm"))

```


La siguiente gráfica nos muestra mejor los resultados anteriores, colocando las funciones de densidad antes y después de Matching una encima de la otra para ver las diferencias. Se puede apreciar que a excepción de los puntajes casi cercanos a 0, tienen prácticamente la misma función densidad.

```{r fig.align="center", echo=FALSE, fig.width=9, fig.height=4}

# Create histogram with density curves
ggplot(ps_data, aes(x = distance, fill = match)) +
  geom_histogram(alpha = 0.5, position = "identity", bins = 20) +
  geom_density(alpha = 0.5) +
  labs(x = "Puntaje de propensión", y = "Densidad", fill = "Matching") +
  ggtitle("Puntaje de propensión antes y después de Matching") +
  theme_minimal() +
  geom_segment(aes(x = -0.05, xend = 0.05, y = 260, yend = 260), color = "purple", linetype = "dotted", size = 0.75) +
  geom_segment(aes(x = -0.05, xend = 0.05, y = 320, yend = 320), color = "purple", linetype = "dotted", size = 0.75) +
  geom_segment(aes(x = -0.05, xend = -0.05, y = 260, yend = 320), color = "purple", linetype = "dotted", size = 0.75) +
  geom_segment(aes(x = 0.05, xend = 0.05, y = 260, yend = 320), color = "purple", linetype = "dotted", size = 0.75) +
  theme(plot.margin = unit(c(2, 2, 2, 2), "cm"))

```
\newpage
# Modelado

En este estudio, optamos por el uso del modelo de regresión por mínimos cuadrados ordinarios (OLS, por sus siglas en inglés) para examinar las relaciones entre la política pública Bolsa Familia y las tres variables objetivo que hemos identificado: tasa de empleo, nivel de educación y tasa de pobreza. Este método ha sido seleccionado debido a su simplicidad interpretativa y al hecho de que proporciona estimaciones insesgadas de los coeficientes, bajo el supuesto de que los errores son normalmente distribuidos y homoscedásticos. Además, dada la gran cantidad de datos a nivel municipal que tenemos, las estimaciones de OLS serán eficientes y consistentes, lo que nos permitirá obtener conclusiones sólidas a partir de los resultados de la regresión.

La decisión de utilizar la regresión OLS también está fundamentada en nuestro enfoque de emparejamiento de los municipios. Este enfoque garantiza que nuestros municipios tratados y de control sean comparables en las dimensiones observables, permitiendo que la variación en la implementación de Bolsa Familia sea utilizada como un experimento natural para identificar su impacto en nuestras variables objetivo. Utilizando la variable de tratamiento - la implementación de Bolsa Familia - como una variable regresora en nuestro modelo de regresión, podremos examinar de manera efectiva la relación causal entre Bolsa Familia y nuestras variables objetivo. En resumen, la regresión OLS con la variable de tratamiento como regresora permite un análisis más preciso y riguroso de la efectividad de la política pública en cuestión.

## Resultados

```{r fig.align="center", echo=FALSE, include = FALSE}

# Realizamos la regresión OLS para cada variable de interés
model1 <- lm(ab_ef ~ treatment, data = data_matched)
model2 <- lm(pibcapita ~ treatment, data = data_matched)
model3 <- lm(idhm_l_2010 ~ treatment, data = data_matched)

# Creamos una tabla resumen con stargazer
stargazer(model1, model2, model3, type = "latex", title = "Efectos de Bolsa Familia sobre Tasa de Desercion Escolar, PIB per capita e IDH")

#htmltools::includeHTML("models_summary.html")
```
\begin{center}
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{3}{c}{\textit{Variable dependiente:}} \\ 
\cline{2-4} 
\\[-1.8ex] & ab\_ef & pibcapita & idhm\_l\_2010 \\ 
\\[-1.8ex] & (1) & (2) & (3)\\ 
\hline \\[-1.8ex] 
 Tratamiento & 3.989$^{***}$ & $-$8.997$^{***}$ & $-$0.061$^{***}$ \\ 
  & (0.084) & (0.286) & (0.001) \\ 
  & & & \\ 
 Control & 2.017$^{***}$ & 14.798$^{***}$ & 0.832$^{***}$ \\ 
  & (0.059) & (0.202) & (0.001) \\ 
  & & & \\ 
\hline \\[-1.8ex] 
Observaciones & 5,474 & 5,474 & 5,474 \\ 
R$^{2}$ & 0.293 & 0.153 & 0.479 \\ 
R$^{2}$ Ajustado & 0.293 & 0.153 & 0.479 \\ 
Error residual estándar (df = 5472) & 3.099 & 10.575 & 0.032 \\ 
Estadístico F (df = 1; 5472) & 2,267.128$^{***}$ & 990.460$^{***}$ & 5,023.705$^{***}$ \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{3}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{center}
 
En cada resumen, el coeficiente de la variable tratamiento es de interés primordial. Este coeficiente representa el cambio promedio en la variable de resultado correspondiente por cada incremento unitario en la variable de tratamiento, controlando por las otras variables en el modelo.

Si el coeficiente de treatment es positivo, eso indica que la implementación de la política de Bolsa Familia está asociada con un incremento en la variable de resultado, y si es negativo, indica una disminución. El nivel de significancia de (generalmente denotado por su p-value en la salida del resumen del modelo) indica si el efecto es estadísticamente significativo.

1. El coeficiente para la tasa de deserción escolar es 3.989 y significativo al 1%; esto sugiere que la implementación de la política de Bolsa Familia está asociada con un incremento promedio de aproximadamente 4 puntos porcentuales en el abandono escolar. 

2. El coeficiente para el PIB per cápita es -8.997 y significativo al 1%; esto sugiere que la implementación de la política de Bolsa Familia está asociada con un decremento promedio de aproximadamente 9 unidades en el PIB per cápita.

3. El coeficiente para el Índice de Desarrollo Humano es -0.061 y significativo al 1%; esto sugiere que la implementación de la política de Bolsa Familia está asociada con un decremento promedio de aproximadamente 0.06 puntos en dicho índice. 

A pesar de que el Matching debería hacer que la asignación del tratamiento sea "as good as random", podemos corroborar que estos efectos son correctos corriendo una regresión sobre todas las variables (Cuadro 4) que tenemos:

\newpage
```{r fig.align="center", echo=FALSE, include = FALSE}

# Realizamos la regresión OLS para cada variable de interés
model11 <- lm(ab_ef ~ ., data = data_matched[, !(colnames(data_matched) %in% c('pc_pbf_pop', 'pibcapita', 'ap_ef', 'idhm_l_2010','ano','nome_municipio', 'weights','subclass'))])
model21 <- lm(pibcapita ~ ., data = data_matched[, !(colnames(data_matched) %in% c('pc_pbf_pop', 'ab_ef', 'ap_ef', 'idhm_l_2010','ano','nome_municipio', 'weights','subclass'))])
model31 <- lm(idhm_l_2010 ~ ., data = data_matched[, !(colnames(data_matched) %in% c('pc_pbf_pop', 'ab_ef', 'ap_ef', 'pibcapita','ano','nome_municipio', 'weights','subclass'))])

# Creamos una tabla resumen con stargazer
stargazer(model11, model21, model31, type = "latex", title = "Efectos de Bolsa Familia sobre Tasa de Desercion Escolar, PIB per capita e IDH")

#htmltools::includeHTML("models_summary1.html")
```

\begin{table}[!htbp] \centering 
  \caption{Efectos de Bolsa Familia sobre Tasa de Desercion Escolar, PIB per capita e IDH} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{3}{c}{\textit{Dependent variable:}} \\ 
\cline{2-4} 
\\[-1.8ex] & ab\_ef & pibcapita & idhm\_l\_2010 \\ 
\\[-1.8ex] & (1) & (2) & (3)\\ 
\hline \\[-1.8ex] 
 cobalvopbf & $-$0.003 & 0.009 & 0.00003 \\ 
  & (0.002) & (0.007) & (0.00002) \\ 
  & & & \\ 
 porteibge & 0.373$^{***}$ & 0.646$^{***}$ & 0.001$^{***}$ \\ 
  & (0.040) & (0.136) & (0.0004) \\ 
  & & & \\ 
 rdpc\_2010 & 0.003$^{***}$ & $-$0.002 & $-$0.00001 \\ 
  & (0.001) & (0.003) & (0.00001) \\ 
  & & & \\ 
 propextpobre\_2010 & $-$6.050$^{***}$ & 4.519 & $-$0.062$^{***}$ \\ 
  & (0.888) & (3.004) & (0.008) \\ 
  & & & \\ 
 rep\_ef & 0.101$^{***}$ & 0.130$^{***}$ & $-$0.0003$^{***}$ \\ 
  & (0.007) & (0.025) & (0.0001) \\ 
  & & & \\ 
 rep\_em & $-$0.046$^{***}$ & 0.014 & 0.0001$^{**}$ \\ 
  & (0.006) & (0.021) & (0.0001) \\ 
  & & & \\ 
 pbf\_capita & 0.003$^{***}$ & $-$0.004 & $-$0.0001$^{***}$ \\ 
  & (0.001) & (0.004) & (0.00001) \\ 
  & & & \\ 
 alunospbf & $-$0.0001 & $-$0.0005$^{***}$ & 0.00000$^{***}$ \\ 
  & (0.00005) & (0.0002) & (0.00000) \\ 
  & & & \\ 
 fam\_pbf & 0.001$^{***}$ & 0.0004 & $-$0.00000$^{***}$ \\ 
  & (0.0001) & (0.0005) & (0.00000) \\ 
  & & & \\ 
 pc\_alunospbf & 0.001 & $-$0.083$^{***}$ & $-$0.0001$^{***}$ \\ 
  & (0.003) & (0.010) & (0.00003) \\ 
  & & & \\ 
 pbf\_valor & $-$0.00000$^{***}$ & 0.00000$^{***}$ & 0.000 \\ 
  & (0.00000) & (0.00000) & (0.000) \\ 
  & & & \\ 
 treatment & 0.581$^{***}$ & $-$0.524 & $-$0.003$^{**}$ \\ 
  & (0.128) & (0.434) & (0.001) \\ 
  & & & \\ 
 distance & 0.857$^{***}$ & $-$20.020$^{***}$ & $-$0.011$^{***}$ \\ 
  & (0.262) & (0.888) & (0.002) \\ 
  & & & \\ 
 Constant & 25.925$^{***}$ & 8.020 & 0.694$^{***}$ \\ 
  & (2.022) & (6.843) & (0.019) \\ 
  & & & \\ 
\hline \\[-1.8ex] 
Observations & 5,474 & 5,474 & 5,474 \\ 
R$^{2}$ & 0.551 & 0.471 & 0.726 \\ 
Adjusted R$^{2}$ & 0.548 & 0.468 & 0.725 \\ 
Residual Std. Error (df = 5445) & 2.476 & 8.382 & 0.023 \\ 
F Statistic (df = 28; 5445) & 238.339$^{***}$ & 172.946$^{***}$ & 516.126$^{***}$ \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{3}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table}

Aquí podemos observar que a pesar de que los efectos controlados son menores, el signo y la significacia se mantienen, indicando que el programa de Bolsa Familia produce efectos adversos a los que esperaríamos. La estimación de los coeficientes no es la misma puesto que en teoría, el Matching absorbe los efectos de los confounders y produce distribuciones los más iguales posibles, pero naturalmente en datos reales esta discrepancia puede ser mayor debido a una diversidad de factores.

## Conclusiones

Este estudio ha proporcionado evidencia empírica de que el programa Bolsa Familia, una política pública diseñada para mejorar la calidad de vida en los municipios brasileños, parece estar correlacionado de manera inesperada con un aumento en la deserción escolar y una disminución en el PIB per cápita y el Índice de Desarrollo Humano (IDH). Estos hallazgos requieren una reflexión seria sobre el diseño y la implementación de políticas públicas similares, y plantean interrogantes sobre el mecanismo subyacente que ha generado estos resultados contraintuitivos.

Existen varias explicaciones potenciales para estos hallazgos. En primer lugar, es posible que Bolsa Familia, al proporcionar un subsidio financiero a las familias, pueda estar desincentivando inadvertidamente la asistencia a la escuela y la participación en el mercado laboral, lo que contribuye al aumento de la deserción escolar y a la disminución del PIB per cápita. Además, puede haber factores de confusión no observados que estén correlacionados tanto con la adopción de la política de Bolsa Familia como con las variables de resultado, como la deserción escolar y el PIB per cápita.

En segundo lugar, puede existir una relación indirecta entre Bolsa Familia y el IDH a través de su efecto en la educación y el PIB. Si Bolsa Familia está llevando a una mayor deserción escolar y a una menor participación en el mercado laboral, es probable que también esté afectando negativamente a los componentes educativos y económicos del IDH.

En última instancia, estos resultados pueden sugerir fallas en la implementación, ya sea por negligencias administrativas en todo el sistema, falta de capacidad para monitorear a los beneficiarios, e incluso conductas más turbias.  Una línea de investigación que puede ser relevante explorar en futuros estudios involucra la posible interferencia de la corrupción en la implementación y eficacia de la política.

Es concebible que, en un contexto de corrupción generalizada, la efectividad de la política pública pueda verse mermada. Por ejemplo, los fondos destinados a las familias pueden ser desviados o mal gestionados, lo que puede generar resultados inesperados y contraproducentes como los observados en este estudio. Esto no es una acusación de corrupción, sino una hipótesis que surge de la discordancia entre la intención de la política pública y los resultados obtenidos.

Los hallazgos subrayan la importancia de monitorizar y evaluar cuidadosamente los efectos inesperados de las políticas públicas. Estos resultados sugieren que la implementación puede haber tenido consecuencias no intencionadas. Futuras investigaciones deberán explorar más a fondo estos hallazgos y buscar soluciones para mitigar estos efectos adversos.


\newpage

# Referencias

Banco Interamericano de Desarrollo. (2016). Síntesis del Programa Bolsa Familia en brasil | publications. https://publications.iadb.org/en/publications/spanish/viewer/S%C3%ADntesis-del-programa-Bolsa-Familia-en-Brasil.pdf

Bandiera, A. (2023). Presentaciones Tópicos políticas públicas.

Lindert, K., Linder, A., Hobbs, J., & De la Brière, B. (2007). The Nuts and Bolts of Brazil’s Bolsa Família Program: Implementing Conditional Cash Transfers in a Decentralized Context. World Bank SP Discussion Paper, No. 0709.

Soares, S., Ribas, R. P., & Osório, R. G. (2010). Evaluating the Impact of Brazil's Bolsa Família: Cash Transfer Programmes in Comparative Perspective. Latin American Research Review.

# Repositorio

[Bolsa familia](https://github.com/Cabesoniko14/Bolsa_Familia_TPP2)
